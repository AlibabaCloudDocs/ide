# 基线预警与事件告警 {#concept_tdf_bvn_42b .concept}

本文将从监控范围、捕获任务、判断报警对象、判断报警时机、报警方式和报警升级等方面，为您介绍基线预警与事件告警的功能逻辑。

## 监控范围 {#section_gzz_cvn_42b .section}

基线是一组节点的管理单位，即节点分组，您可以通过基线来设置任务纳入监控的方式。

一条基线纳入监控后，该基线及基线上游的所有任务都会被监控。此时智能监控不默认监控所有任务，被监控的任务下游必须有被纳入监控基线的任务。如果下游没有任务被纳入监控基线，即使该任务出错，智能监控也不会报警。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16366/15631864007435_zh-CN.png)

如上图所示，假设整个DataWorks只有6个任务节点，任务D和E属于纳入基线上的节点。任务D和E及它们所有的上游节点，都会被纳入监控范围。即上图中A、B、D、E任务出现异常（出错或变慢），也会被智能监控察觉，而任务C和任务F不受智能监控的监控。

## 捕获任务 {#section_pbw_4wn_42b .section}

确定监控范围后，如果在监控范围内的任务出现异常，智能监控会生成一个事件，所有的报警决策都是基于对这个事件的分析。任务的异常包括两种类型，您可以导航至**事件管理** \> **事件类型**页面进行查看。

-   **出错**：任务运行失败。
-   **变慢**：任务本次运行时间和过去一段时间内的平均运行时间相比，明显变长。

**说明：** 如果一个任务先超时，再出错，会生成两个事件。

## 判断报警对象 {#section_qwt_zwn_42b .section}

当智能监控捕获到一个异常任务并生成事件后，首先要决策报警对象，顺序如下：

1.  确认任务所在规则是否有对应的值班表。如果有，则值班表上的值班人员为报警接收人。
2.  如果上述值班表不存在，则将任务责任人设置为报警接收人。

整个规则的报警由任务规则上对应的值班表接收。一些应用的负责人会在团队内实行值班制度，即一段时间由一个值班人员接收报警。如果上述值班表不存在，则智能监控判断最终由任务责任人为该异常负责。

## 判断报警时机 {#section_vbj_2xn_42b .section}

**余量**是智能监控中的一个重要概念，指任务可以被允许拖延开始的最长时间。任务的最晚开始时间=基线时间–平均运行时间。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16366/15631864007438_zh-CN.png)

如上图所示，要满足基线A的基线时间5:00，向上倒推，则要求任务E的最晚开始时间为5:00减任务F的运行时间20分钟，再减任务E的运行时间30分钟，即为4:10。该时间也是满足基线A的任务B的最晚完成时间。

要满足基线B的基线时间6:00，向上倒推，则要求任务B的最晚完成时间为6:00减任务D的运行时间2小时，即为4:00，早于4:10。即任务B的最晚完成时间为4:00，方可同时满足基线A和基线B。

任务A的最晚完成时间为4:00减任务B的运行时间2小时，即为2:00，最晚开始时间为2:00减任务A的运行时间10分钟，即为1:50。如果A无法在1:50分开始运行，则基线A容易破线。

假设1点时任务A运行出错，则此时任务A的余量时间即为1:50和1:00之间的差值，即50分钟。由该示例可见，余量是一个任务异常的警戒程度的体现。

## 基线报警 {#section_p2l_zxn_42b .section}

基线报警是针对已经开启基线开关的基线的一个附加功能，每个基线都必须提供预警余量和承诺时间。基线报警指当某个时间，智能监控预测基线的完成时间超过预警余量，则会直接通知设置的报警对象，共3次，每次间隔30分钟。

## 报警方式 {#section_q2l_zxn_42b .section}

基线报警目前默认发送给基线责任人。您可以根据自身需求，在**规则管理**页面找到**全局基线预警**，选择**详情**，修改报警触发方式和报警行为。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16366/156318640048337_zh-CN.png)

## 报警升级 {#section_r2l_zxn_42b .section}

如果您在40分钟内，没有及时关闭智能监控产生的事件报警，则报警会升级。报警升级的流程如下：

1.  查看异常任务对应的规则是否关联有值班表。如果有，则升级给值班表值班人员。
2.  如果上述值班表不存在，则将升级给任务责任人的主管。

您可以在智能监控页面关闭报警事件。

## 甘特图功能 {#section_s2l_zxn_42b .section}

甘特图功能属于智能监控**基线实例**模块，反映的是一个任务的关键路径情况。

**说明：** 关键路径是指导致该任务在该时间点完成的上游最慢链路。

