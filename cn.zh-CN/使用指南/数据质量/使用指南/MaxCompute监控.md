# MaxCompute监控 {#concept_j2n_f13_r2b .concept}

规则配置模块是数据质量（DQC）的核心，目前数据质量支持离线的MaxCompute监控和DataHub监控，本文将为您介绍如何配置离线MaxCompute监控。

## 添加数据源 {#section_tc4_h13_r2b .section}

您需进入数据集成页面添加数据源，详情请参见[配置MaxCompute数据源](cn.zh-CN/使用指南/数据集成/数据源配置/配置MaxCompute数据源.md#)。新建成功后，即可进入数据质量（DQC）页面进行规则的配置。

## 选择数据源 {#section_znc_wcp_dhb .section}

1.  单击左侧导航栏的**规则配置**，进入规则配置页面。
2.  选择**MaxCompute**，即可显示当前数据源下所有的表。

    您也可输入对象表名（支持表名首字母模糊搜索），找到对应的表。

3.  单击右侧的**配置监控规则**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/15602249548793_zh-CN.png)


## 配置分区表达式 {#section_bby_bb3_r2b .section}

分区表达式是数据质量用来确定所配置的某条规则，应检查对应表的哪一个分区的表达式说明。

**说明：** 

-   如果您的检查对象为非分区表，则此处可填写为NOTAPARTITIONTABLE 。
-   如果您的表为分区表，则可以配置为业务日期的表达式（如$\[yyyymmdd\]），同时也可以配置为相关格式的正则表达式。

进入数据表的规则配置页面，单击左上角的**+**，添加分区表达式。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/15602249548796_zh-CN.png)

-   新建分区的表达式：单击左上角的**+**，会弹出分区配置窗口，您可根据自身需求编辑符合语法的分区表达式。非分区表可以直接选择推荐的分区表达式中的**NOTAPARTITIONTABLE**。

    -   一级分区的表达式格式：分区名=分区值，分区值可以是固定值，也可以是内置参数表达式。分区表必须配置到最后一级分区。
    -   多级分区表达式格式：1级分区名=分区值/2级分区名=分区值/N级分区名=分区值，分区值可以是固定值，也可以是内置参数表达式。参数必须使用中括号表示。
    分区表达式周期由配置的业务日期决定，例如配置运行时间为前5天，则周期为每5天调度一次。支持的分区表达式如下表所示。

    |分区表达式|说明|
    |:----|:-|
    |dt=$\[yyyymmdd-N\]|代表前N天。|
    |dt=$\[yyyymm01-1\]|代表每月1日。|
    |dt=$\[yyyymm01-Nm\]|代表N月前1日。|
    |dt=$\[yyyymmld-1\]|代表每月最后一天。|
    |dt=$\[yyyymmld-1m\]|代表N月前最后一天。|
    |dt=$\[hh24miss-1/24\]|代表一个小时前。|
    |dt=$\[hh24miss-30/24/60\]|代表半个小时前。|
    |$\[yyyymmdd\]|调度日期。|
    |$\[yyyymmdd-1\]|格式为`yyyymmddmiss-1`，默认为当前实例运行的业务日期的前一天。|
    |$\[yyyymmddhh24miss\]|格式为`yyyymmddhh24miss`，当前实例运行的业务日期。     -   yyyy表示4位数年份
    -   mm表示2位数月份
    -   dd表示2位数天
    -   hh24表示24小时制的时
    -   mi表示2位数分钟
    -   ss表示2位数秒
 |
    |NOTAPARTITIONTABLE |非分区表可以选择此分区表达式。|

-   推荐的分区表达式：下文将以分区名dt为例，为您介绍推荐的分区表达式。如果表是动态分区表，则不建议使用含有正则的分区表达式。
    1.  单击输入表达式的窗口，会显示数据质量为您推荐的分区表达式。
        -   如果有符合预期的表达式，单击该行，则会自动同步到输出窗口。
        -   如果没有满足的分区表达式，您可以根据需求自己输入。
    2.  输入分区表达式后，单击**计算**。数据质量会按照当前时间（调度时间）计算出分区表达式的计算结果，以便验证分区表达式的正确性。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/15602249548798_zh-CN.png)

    3.  单击**确认**。
-   删除已添加分区表达式：不需要的分区表达式可以删除。如果该分区表达式已经配置有规则，删除时会删除该表达式下的所有规则。

## 关联调度 {#section_qym_j23_r2b .section}

如果要在生产链路上监控离线数据质量，需要将数据质量关联调度。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/156022495441129_zh-CN.png)

**说明：** 

-   关联界面仅能找到已经提交的节点，且关联调度支持跨项目的关联。
-   关联前，请确保您在关联的两个项目中，同时拥有**管理员**、**开发**或**运维**中至少一个角色。

数据质量的关联调度可以关联单个或多个节点任务，关联调度完成后，离线数据质量监控任务可以自动运行。

**说明：** 目前数据质量的配置关联较为灵活，您关联的任务并非一定要与您的表有关系。

关联配置步骤如下：

1.  进入**运维中心** \> **周期任务**页面。
2.  单击对应任务后的**更多**，选择**配置质量监控**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/15602249558804_zh-CN.png)

3.  输入对应项目名称、生产环境的表名进行搜索，单击相应分区表达式后的**配置**（您也可自行添加分区表达式），即可对此分区表达式进行配置。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/15602249558805_zh-CN.png)


## 创建规则 {#section_jdy_hh3_r2b .section}

创建规则是数据质量模块的核心内容，您可根据表的实际需要创建规则。

目前创建规则的方式包括模板规则和自助规则，您可根据自身需求选择相应方式。两种规则又分为**添加监控规则**和**快捷添加**两部分，详情请参见[规则配置](cn.zh-CN/使用指南/数据质量/功能介绍/规则配置.md#)。

创建完成后单击**批量保存**，即可将创建的所有规则保存到已建好的分区表达式。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/15602249558809_zh-CN.png)

|**添加方式**|配置|说明|
|:-------|:-|:-|
|**添加监控规则**|**字段类型**|包括表级规则和字段级规则，字段级规则可针对表中的具体字段配置监控规则。此处选择为表级规则，页面中其他设置项对应为表级规则配置项。|
|**强弱**|配置规则的强弱。当勾选强，任务运行时若触发红色阈值，则会将任务置为失败状态。 -   勾选强时，若触发红色阈值，则报警且任务置为失败状态。若触发橙色阈值，则报警且任务置为成功状态。
-   勾选弱时，若触发红色阈值，则报警且任务置为成功状态。若触发橙色阈值，则不报警且任务置为成功状态。

 |
|**模板类型**|系统内置的表级监控规则模块。|
|**趋势**|根据所选模板类型的不同，趋势可包括绝对值、上升和下降等类型。|
|**波动值比较**|设置波动值的橙色阈值和红色阈值。您可通过拖动进度条来设置，也可直接输入阈值。|
|**快捷添加**|**字段名**|只有字段级规则，字段级规则可针对表中具体字段进行配置监控规则。此处选择具体字段，对其设置字段级规则。|
|**规则类型**|选择字段空值或字段重复值。|

## 试跑 {#section_bpf_sk3_r2b .section}

成功配置规则后，可针对某个分区表达式下所有规则进行试跑，并查看试跑的校验结果。

**说明：** 通过试跑，可以测试规则配置的正确性、测试订阅发送渠道，它是手动运行监控规则的一种方式，您可以根据自身需求选择是否进行试跑。

1.  选择需要试跑的调度日期，单击**试跑**，即可进行试跑。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/15602249558816_zh-CN.png)

    |配置|说明|
    |:-|:-|
    |**试跑分区**|实际分区会随着业务日期变化而改变。如果为NOPARTITIONTABLE，则会自动添加实际分区。|
    |**调度时间**|默认为当前时间。|

2.  单击**试跑成功！点击查看试跑结果**，即可跳转至[任务查询](cn.zh-CN/使用指南/数据质量/功能介绍/任务查询.md#)页面，查看校验结果。

## 订阅管理 {#section_fj5_4c4_r2b .section}

订阅管理默认通知创建者，若想通知其他用户，您可以手动添加，支持邮件、短信和钉钉通知。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/156022495641132_zh-CN.png)

## 转交责任人 {#section_egg_y3p_dhb .section}

当责任人离职或者转岗，可以将分区表达式负责人转交给其他项目成员。默认分区表达式负责人为创建人。

当把鼠标放在责任人上时，会在后面显示一个隐藏按钮，单击可修改责任人，输入交接人的名称，单击**确认**即可提交成功。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/156022495641135_zh-CN.png)

## 更多 {#section_atk_vc4_r2b .section}

**更多**选项中包括分区操作日志、上一次校验结果和复制规则。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/15602249568818_zh-CN.png)

|操作|说明|
|:-|:-|
|**分区操作日志**|显示对当前分区表达式所有的规则设置的记录。|
|**上一次校验结果**|会跳转到任务查询页面，查看当前分区表达式下的运行结果情况，您还可在此查看历史结果。|
|**复制规则**|可将当前设置的规则复制到目标表达式中，还可同步订阅人。|

