# 规则配置 {#concept_w42_3r3_r2b .concept}

目前数据质量支持离线的MaxCompute监控和DataHub监控，本文将为您介绍如何配置MaxCompute规则。

-   选择MaxCompute数据源，即可显示当前数据源下所有的表。您也可以使用搜索功能，快速定位至其他数据源下查看表。
-   选择Datahub数据源，即可显示当前数据源下所有的Topic。您也可以使用搜索功能，快速定位至其他数据源下查看Topic。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/15617154788793_zh-CN.png)

单击**配置监控规则**，即可进入**规则配置**页面。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/156171547841042_zh-CN.png)

配置模板规则前，需首先配置分区表达式，详情请参见[配置分区表达式](intl.zh-CN/使用指南/数据质量/使用指南/MaxCompute监控.md#section_bby_bb3_r2b)。目前数据质量规则配置包括**模板规则**和**自定义规则**。

## 模板规则 {#section_tc4_h13_r2b .section}

您可以通过**添加监控规则**创建规则。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/156171547941046_zh-CN.png)

|配置|说明|
|--|--|
|**规则名称**|请输入规则名称。|
|**规则字段**|包括表级规则和字段级规则，字段级规则包括**数据类型**和**非数据类型**。|
|**规则模板**|目前共有37种规则，不支持的规则模板将不能被选择。 **说明：** 目前平均值、汇总值、最小值和最大值仅对数值型字段生效。

 |
|**比较方式**|包括**绝对值**、**上升**和**下降**。|
|**波动值比较**| -   计算波动率，您可以根据波动率计算公式计算结果。

波动率=（样本-基准值）/基准值。

-   计算方差波动

（当次样本-历史N天平均值）/标准差，标准差即为方差（表中通常有BIGINT和DOUBLE字段类型）。


 **说明：** 样本和基准值的名词解释如下：

-   样本：当天采集的具体的样本的值。例如对于SQL任务表行数，1天波动检测，则样本是当天分区的表行数。
-   基准值：历史样本的对比值。
    -   如果规则是SQL任务表行数，1天波动检测，则基准值是前一天分区产生的表行数。
    -   如果规则是SQL任务表行数，7天平均值波动检测，则基准值是前7天的表行数据的平均值。

 您可以设置**橙色阈值**和**红色阈值**，对不同严重程度的问题进行监控。

-   强质量规则的红色报警阻塞下游任务节点，防止质量问题扩散及计算资源浪费。
-   通过短信/邮件/钉钉群机器人进行报警。

 |

下图为报警与阻塞的实现逻辑。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/156171547941061_zh-CN.png)

|校检方法|校检逻辑|
|:---|:---|
|波动值校验| -   如果校验值的绝对值小于或等于橙色阈值，则返回**正常**。
-   如果校验值的绝对值不满足第一种情况，且小于或等于红色阈值，则返回**橙色报警**。
-   如果校验值不满足第二种情况，则返回**红色报警**。
-   如果没有橙色阈值，则只有红色报警和正常两种情况。
-   如果没有红色阈值，则只有橙色报警和正常两种情况。
-   两个都不填写，则为红色报警（通常会禁止两个阈值不填的情况）。

 |
|固定值比较| -   根据校验的表达式计算soptexpect，返回布尔值，opt支持大于、小于、等于、大于等于、小于等于和不等于。
-   根据上式的计算结果，如果为true，返回正常，否则返回红色报警。

 |

## 自定义规则 {#section_mf3_q2k_dhb .section}

如果模板规则不能满足您对分区表达式中数据质量的监控需求，您还可以通过创建**自定义规则**来满足个性化的监控需求。

在创建**自定义规则**页面，您可以根据自身需求选择创建表级规则或自定义SQL。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16396/156171547941062_zh-CN.png)

|配置|说明|
|--|--|
|**规则名称**|请输入规则名称。|
|**规则字段**|支持**表级规则**和**自定义SQL**。 -   表级、字段级自定义规则，支持根据业务属性自定义where过滤条件。
-   自定义SQL支持完全自定义SQL逻辑（单行单列输出）。

 |
|**采样方式**|支持**count**和**count/table\_count**两种方式。|
|**过滤条件**|例如：您需要查询业务日期下表的分区，可以将where条件设置为`pt=$[yyyymmdd-1]`。|
|**校检类型**|支持**数值型**和**波动率型**两种类型。|
|**比较方式**|包括**大于**、**大于等于**、**等于**、**不等于**、**小于**和**小于等于**六种比较方式。|
|**比较方式**|包括**绝对值**、**上升**和**下降**。|
|**与固定值比较**|目前支持**与固定值比较**。|

