# 数据同步任务调优 {#concept_hy2_z3z_lgb .concept}

数据同步任务调度运行时，您可能会遇到实例的执行时间超过预期的情况。本文为您介绍如何在数据同步任务实例执行慢、时间差异大等不满足预期的情况下进行调优的方法。

## 场景分类 {#section_y5w_kjz_lgb .section}

通常数据同步任务执行慢的场景分为以下三种：

-   任务开始运行的时间和调度时间差异比较大。
-   任务长时间处于WAIT状态。
-   任务同步的速率慢。

## 前提条件 {#section_o5s_2kz_lgb .section}

正式开始数据同步任务调优前，请首先收集下列信息：

-   任务运行日志（从日志开始打印到结束）
-   任务的属性标签页信息

针对数据同步任务，DataWorks的调度资源分为一级调度资源和二级运行资源。

-   一级调度资源： 您可以进入**运维中心** \> **周期任务运维** \> **周期实例**页面，右键单击相应节点，选择**查看更多详情**，即可查看该节点的**属性**。

    ![属性](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/105149/156768426437316_zh-CN.png)

-   二级运行资源：您可以进入**数据集成** \> **同步资源管理** \> **资源组**页面，新增和查看二级任务运行资源。

## 场景一：任务开始运行时间和调度时间差异较大 {#section_n3s_fkz_lgb .section}

在该场景下，您首先需要任务运行日志和任务**属性**标签页信息 。对比分析发现， **运行日志**中开始running的时间和**属性**节点的调度时间是有差异的，时间主要耗费在等待调度上。

问题示例

1.  在**运维中心**中的**周期任务**页面查看用户任务的属性标签页查，发现调度时间在00:00， 但是开始运行时间在00:29，怀疑时间主要消耗在等待调度上。

    ![查看日志](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/105149/156768426437324_zh-CN.png)

2.  在实例页面右键查看用户**任务运行日志**，任务从00:29分开始运行，00:30执行结束，整个任务执行仅仅花费了1分钟。说明本次任务本身执行无问题。

问题解法

1.  首先建议您观察您的项目下是否有较多的任务同时调度。默认资源组下的一级调度资源有限， 同时调度的任务较多会有其他任务排队等待。
2.  通常每天0点-2点是业务调度的高峰期， 建议您的业务运行时间尽量避开高峰期 。

## 场景二：任务同步速率慢 {#section_cth_gl3_mgb .section}

在该场景下，通过分析运行日志，通常有以下两种情况：

-   任务一直在运行，但速率是0。
-   任务速率较低。

任务速率为0

查看运行日志，看到任务长时间处于run的状态，速率为0。通常是由于拉取的SQL执行比较慢（源数据库CPU负载高或网络流量占用高），或在拉取SQL前进行[truncate](../../../../cn.zh-CN/开发/SQL及函数/DDL语句/表操作.md#)等操作，导致处理时间较长。

问题示例

1.  查看任务运行日志，任务长时间在run，速率为0，从18:00开始到21:13结束。

    ![查看日志](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/105149/156768426537591_zh-CN.png)

    ![查看日志](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/105149/156768426537592_zh-CN.png)

2.  查看运行日志信息有truncate操作记录，从18:00开始到21:13 truncate操作结束。

    ![查看日志](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/105149/156768426537593_zh-CN.png)


问题解法

如上所示，可能是truncate操作导致的同步任务慢，您需要检查源数据库truncate慢的原因。

任务速率慢

查看运行日志，看到任务同步速率不为0，但是速率慢。

问题示例

1.  获取运行日志后，查看日志中信息同步速率确实比较慢， 约为1.93kb/s。

    ![查看日志](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/105149/156768426537594_zh-CN.png)

2.  查看运行日志中同步时间消耗字段WaitWriterTime、WaitReaderTime的信息， 发现WaitReaderTime时长较长，主要在等待读数据。

    ![查看日志](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/105149/156768426537595_zh-CN.png)


问题解法

针对速率比较慢的情况， 可以看下主要在等Writer还是Reader，如果是读或写慢，需要查看对应的源数据库或目的数据库的负载情况。

