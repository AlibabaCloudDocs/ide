# 依赖关系 {#concept_gbk_lxx_p2b .concept}

调度依赖配置页面如下图所示：

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16303/15380618257925_zh-CN.png)

调度的总逻辑:上游执行成功才触发下游调度,因此所有工作流节点都必须至少有一个父节点,调度依赖就是设置这个父子依赖关系。

## 自动解析和自定义依赖的区别 {#section_nv5_p1y_p2b .section}

自动解析是根据代码中的血缘关系，解析出本节点的输入及本节点的输出。

自定义添加依赖，是当血缘关系不准确时，额外添加的上游依赖，建议尽量保证代码血缘的准确性，减少使用自定义依赖的次数。下面介绍如何正确的配置节点的输入输出。

自动解析：通过代码自动解析调度依赖关系。

如ODPS SQL类型节点代码如下：

```
insert overwrite table table_a as select * from project_b_name.table_b;
```

系统会判断这个节点应该要依赖产出 table\_b 的节点，同时本节点最终产出 table\_a ，因此解析父节点输出名称为 project\_b\_name.table\_b，本节点的输出名称为本project\_name.table\_a。

-   如果不想用从代码解析到的依赖，那么就选择”否”。

-   如果代码里有很多表是临时表如t\_开头的表为临时表，那么这个表是不会被解析为调度依赖。临时表的定义可以通过应用属性配置来定义以什么开头的表名为临时表。

-   如果代码里一个表名即是产出表又是被引用表（被依赖表）则解析时只解析为产出表。

-   如果代码里一个表名被多次引用或者被多次产出，那么解析时只解析一个调度依赖关系。


**说明：** 默认情况下，表名为t\_开头的会被当前临时表，自动解析不解析临时表。如果t\_开头不是临时表，请联系自己的应用负责人到应用属性里配置应用的临时表标志。

## 依赖的上游节点 {#section_xs5_z3y_p2b .section}

-   依赖的上游节点：即这里要配置哪个节点为本节点的父节点。

    父节点输出名称:即这里需要填的是父节点输出名称，以此来关联父节点达到调度父子关系.可以手动添加，也可以从代码解析。这个节点输出名称填写后会自动解析到父节点的名称和id.若解析不到说明不存在这个输出名称,任务不能依赖不存在的节点,所以这样的节点不可以提交。

-   依赖的上游节点：需要输入父节点的输出名称或者父节点输出的表名。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16303/15380618257926_zh-CN.png)

-   如果任务没有上游，应该如何挂上游依赖？ 一般情况下，任务如果没有依赖，可以挂在项目虚节点下面，常用的项目虚节点比如：项目名\_root。

**说明：** 项目虚节点是指，整个项目下没有上游的任务，都可以挂在项目虚节点下。如果项目中没有项目虚节点，需要联系项目管理员去创建一个项目虚节点，项目虚节点的名称建议为 ：\{项目名\}\_root，比如有一个叫 test 的项目，其项目虚节点应该为：test\_root。

-   依赖的上游节点不存在，应该如何处理？针对这种没有父节点输出节点名的情况，是因为这个表里的数据不是周期任务产出的，可能是手动上传的。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16303/15380618257927_zh-CN.png)


## 本节点的输出 {#section_cfq_cty_p2b .section}

-   本节点的输出：当前节点的输出。
-   输出名称:这里填的是本节点调度上的输出名称,这个名词是全局唯一的，也就是整个工作流不允许有两个任务的输出名称一样。

    一般节点真正产出某个odps表时,这里的写法为本projectname.tablename。后续有其他节点要依赖这个节点，‘父节点输出名称’就是填这个节点的‘输出名称’。 本节点输出名称可以手动添加也可以通过代码解析。 对于下游节点名称,当这个节点有子节点之后会自动解析到,不需要手动填写。

    **说明：** 通过代码解析到的上游依赖和本节点输出显示是红色底，不能直接在节点配置节点删除，需要排除请到节点代码开头 右键选择删除一个输入或者排除一个输出，等号后面填上代码里引用或者产出的表名，注意代码里表名若没有前缀，排除时也不要有前缀。


![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16303/15380618257928_zh-CN.png)

如果有一个表从IDB同步到了ODPS上，但是不知道本节点输出名称应该如何填写？面对这种情况，我们需要了解一下节点名称、输出表名称、本节点输出名称、这三个名称的概念。

节点名称：节点的名字，可能会重名，在不同业务流程下，可以取同名节点。

输出表名称：本节点的产出表名

本节点输出名称：一般与本节点输出表的名称一致。

-   有什么办法可以快速的开发SQL，快速的配置任务？

    DataWorks本节点的输出默认多了一个xxx\_xxxx\_out节点。这个节点用于于业务流程可视化，可以帮助用户快速设置业务流程中业务节点间的依赖关系，通过拖拽直接设置节点的上下游。

-   这种拖拽式的上下游设置，如何保证节点的输入输出并识别下游节点的依赖关系？

    根据血缘关系，自动解析输入输出。本节点的输出，以及本节点输出表名，会根据输出的血缘，在本节点输出表名里让用户自行选择，这样就不需要一个个手动添加了。


![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16303/15380618257929_zh-CN.png)

此处可以直接选择本节点的输出表名。以XXX\_out作为本节点的输出，需要配置本节点的输出表名称，没有配置输出表名称的情况下，下游任务要依赖本节点会比较困难。

**说明：** \_out结尾的本节点输出，为系统默认输出名称，无法删除。

使用了\_out的本节点输出名称，下游任务如何挂依赖呢？

如果使用了XXX\_out作为本节点的输出，下游节点依赖的时候，该如何去设置依赖关系呢？在依赖的上游节点搜索框中，输入依赖的表名，即可展示出父节点的输出名称和父节点输出表名。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/16303/15380618267930_zh-CN.png)

只需要直接选择父节点输出表名即可。除了右键选中节点，还可以通过添加注释的方式修改依赖，具体代码如下:

```
如odps sql任务右键添加删除输入输出：
--@extra_input=表名 --添加输入
--@extra_output=表名 --添加输出
--@exclude_input=表名 --删除输入
--@exclude_output=表名 --删除输出
```

将此语句写在注释最前方，保存代码后重新点击调度界面的“解析输入输出”。

## 常见问题 {#section_sg1_kxy_p2b .section}

Q：通过代码解析到父节点输出名称,但是节点名和id为空,无法提交，怎么办？

A：出现这个情况的原因就是没有节点的输出名称是当前这个名称，所以要在代码里右键选择删除除一个输入，把这个表名依赖删除掉（不会影响代码里使用到这个表的数据），然后节点配置手动添加一个存在的父节点的输出名称。

Q：本节点的输出里，下游节点名称和id都是空的又不能填写怎么办？

A：本节点有子节点之后会自己根据输出名称解析下游节点名称和id，不需要手动填写。另外新建的任务没有子节点也是正常的。

Q:节点的”输出名称“是用来做什么的？

A:本节点的”输出名称”用于建立节点间的依赖关系。假设A节点的输出名称是”ABC”，而B节点将”ABC”作为它的输入，这样节点A与节点B之间就建立了上下游关系。

Q:节点的”输出名称“如何命名？

A:通常用户无需手工指定“输出名称“，系统会自动解析代码，将代码中的产出表作为“输出名称”。而代码中所引用的表作为“输入名称”。这样就全自动地建立了依赖关系。

Q:一个节点可以有多个“输出名称”吗？

A:可以。下游节点引用本节点的任何一个输出名称（作为下游节点的“父节点输出名称”），都将与本节点建立依赖关系。

Q:多个节点可以有相同的“输出名称”吗？

A:不可以。每个节点的“输出名称”必须是全局唯一的。如果真实情况是多个节点输出同一张ODPS表，那么这些节点的输出建议用“表名\_分区标识”

